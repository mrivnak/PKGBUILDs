# Maintainer: Mike Rivnak <rivnakm1@gmail.com>

pkgname="systemd-boot-populate-git"
_pkgname="systemd-boot-populate"
pkgver=.r9
pkgrel=1
arch=(
	'x86_64'
	'i686'
	'aarch64'
	'armhf'
	)
pkgdesc="A script that automatically populates systemd-boot loader entries from installed kernels"
url="https://github.com/mrivnak/systemd-boot-populate"
license=('GPL3')
depends=(
	'python'
	'python-argparse'
	'python-jinja'
	'python-termcolor'
	'python-toml'
	)
makedepends=('git')
conflicts=($_pkgname)
provides=($_pkgname)
source=("${pkgname}::git+${url}.git")
sha512sums=('SKIP')

pkgver() {
	cd ${pkgname}
	printf "%s.r%s" "$(git show -s --format=%ci master | sed "s/\ .*//g;s/-//g")" "$(git rev-list --count HEAD)"
}

package() {
	cd ${pkgname}
	make DESTDIR="$pkgdir" install
	install -m 644 95-systemd-boot-populate.hook /usr/share/libalpm/hooks/95-systemd-boot-populate.hook
}
